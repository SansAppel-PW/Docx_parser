# 文档文本处理器功能说明

## 📖 概述

本模块实现了根据需求规格说明书第3章的要求，将DOCX文档解析结果转换为标准化文本格式的功能。

## 🎯 功能特性

### ✅ 核心功能
- **章节结构识别**：自动识别文档的章节层次结构
- **标准化标签格式**：统一使用 `<|TAG|><|/TAG|>` 闭合标签格式
- **表格数据处理**：按照3.8节规则处理表格，包含表头映射
- **图片格式转换**：自动转换为Markdown格式 `![image](path)`
- **内容类型分类**：段落、列表、表格等不同内容类型的专门处理

### 📋 处理规则（基于需求规格说明书3.1-3.10节）

#### 3.1 删除首页
- 自动识别并跳过首页表格和版本历史表格

#### 3.2 目录页处理
- 转换为Markdown层级标题格式（# ## ###）
- 自动移除页码和装饰性元素

#### 3.3 流程示意图处理
- 整合文本、图片、表格内容
- 使用标准命名格式：`[文档名称]-[章节序号] [章节名称]`

#### 3.4 流程模板处理
- 重点处理模板截图和说明文档
- 保持模板表格的结构化格式

#### 3.5 流程节点功能描述处理
- 包含二级章节的用 `<|SECTION|><|/SECTION|>` 标签包裹
- 支持嵌套章节结构

#### 3.6 子章节处理
- 二级章节标准化命名
- 内容按类型使用相应标签包裹

#### 3.7 具体内容处理
- `<|PARAGRAPH|>[内容]<|/PARAGRAPH|>` - 段落内容
- `<|LISTITEM|>[内容]<|/LISTITEM|>` - 列表项
- `<|TABLE|>[内容]<|/TABLE|>` - 表格内容
- `![image](URL)` - 图片内容

#### 3.8 表格专项处理
- `<|TABLE|><|/TABLE|>` - 表格整体标签
- `<|ROW|><|/ROW|>` - 单行数据标签
- `[表头:内容]` - 表头映射格式
- 自动处理合并单元格情况

#### 3.9 接口处理
- 与流程节点功能描述使用相同处理方式
- 重点处理参数表和返回值表

#### 3.10 其他内容处理
- 灵活处理其他类型的一级章节
- 支持有/无二级章节的不同格式

## 🚀 使用方法

### 单文件处理
```bash
# 处理单个DOCX文件
python docx_parser_modular.py Files/example.docx

# 结果保存在 parsed_docs/single_files/example/ 目录中
# - document.json: JSON结构化数据
# - processed_text.txt: 标准化文本
# - images/: 提取的图片文件
```

### 批量处理
```bash
# 批量处理文件夹中的所有DOCX文件
python docx_parser_modular.py Files/PLM2.0

# 结果保存在 parsed_docs/PLM2.0_parsed/ 目录中
# 每个文件都有独立的子目录包含所有处理结果
```

### 演示和测试
```bash
# 运行完整演示
python demo_text_processing.py

# 运行功能测试
python test_text_processing.py
```

## 📁 输出结构

```
输出目录/
├── document.json          # 完整的JSON结构化数据
├── processed_text.txt     # 🎯 标准化文本结果
└── images/                # 提取的图片文件
    ├── img_001.png
    ├── img_002.png
    └── ...
```

## 📄 输出格式示例

### 基本格式
```
文档名称-1 章节名称：
<|SECTION|>文档名称-1 章节名称-1.1 子章节名称：
<|PARAGRAPH|>段落内容<|/PARAGRAPH|>
![image](images/img_001.png)
<|TABLE|>
<|ROW|>[列1:数据1]|[列2:数据2]|[列3:数据3]<|/ROW|>
<|ROW|>[列1:数据4]|[列2:数据5]|[列3:数据6]<|/ROW|>
<|/TABLE|>
<|/SECTION|>

文档名称-2 另一章节名称：
<|PARAGRAPH|>另一段落内容<|/PARAGRAPH|>
```

### 表格处理示例
```
原始表格：
| 姓名 | 年龄 | 部门 |
|------|------|------|
| 张三 | 25   | 技术 |
| 李四 | 30   | 销售 |

处理结果：
<|TABLE|>
<|ROW|>[姓名:张三]|[年龄:25]|[部门:技术]<|/ROW|>
<|ROW|>[姓名:李四]|[年龄:30]|[部门:销售]<|/ROW|>
<|/TABLE|>
```

## 🔧 技术实现

### 核心模块
- `src/processors/text_processor.py` - 主要的文本处理器
- `src/parsers/document_parser.py` - DOCX文档解析器
- `src/parsers/batch_processor.py` - 批量处理器

### 关键类
- `DocumentProcessor` - 文档内容处理器类
- `process_document_to_text()` - 主要的处理函数

### 处理流程
1. **文档解析** - 将DOCX转换为JSON结构
2. **结构分析** - 识别章节层次和内容类型
3. **内容处理** - 按照规则转换各类内容
4. **格式输出** - 生成标准化文本格式

## ⚠️ 注意事项

### 支持的文档格式
- ✅ DOCX文件（Microsoft Word 2007+）
- ✅ 包含表格、图片、SmartArt的复杂文档
- ✅ 多级章节结构的文档

### 处理限制
- 需要文档具有清晰的章节结构（使用Word标题样式）
- 表格需要有明确的表头行
- 图片会保存为单独文件，需要确保输出目录可写

### 性能考虑
- 大文件处理可能需要较长时间
- 图片较多的文档会占用更多存储空间
- 建议在处理大批量文件时使用快速模式

## 🎯 质量标准

- **解析准确率** ≥ 95%
- **文本处理成功率** ≥ 99%
- **标签格式一致性** 100%
- **章节结构保持度** ≥ 98%

## 🔄 版本信息

- **当前版本**: 1.0.0
- **最后更新**: 2025-08-11
- **兼容性**: Python 3.7+

## 📚 相关文档

- [需求规格说明书](REQUIREMENTS.md) - 详细的处理规则说明
- [使用指南](USAGE.md) - 完整的使用说明
- [快速开始](QUICKSTART.md) - 快速上手指南
